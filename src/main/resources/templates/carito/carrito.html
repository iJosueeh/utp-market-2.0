<!DOCTYPE html>
<html lang="es" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{layout/_layout :: head('Carrito de Compras | UTP Market')}"></head>

<body>
  <!-- Importar layout general -->
  <div th:replace="~{layout/_layout :: header}"></div>

  <main class="container my-5" style="padding-top: 80px;">
    <div class="row">
      <!-- Contenedor para alertas dinámicas -->
      <div id="dynamicAlertContainer" class="col-12"></div>

      <!-- Carrito -->
      <div class="col-lg-8">
        <a th:href="@{/categoria}" class="btn btn-link text-dark mb-3 ps-0">
          <i class="bi bi-arrow-left me-2"></i> Seguir Comprando
        </a>
        <h5 class="fw-bold mb-4">Carrito de Compras</h5>

        <!-- Mensaje cuando el carrito está vacío -->
        <div th:if="${#lists.isEmpty(carritoItems)}" class="text-center py-5">
          <div class="alert alert-info animate__animated animate__fadeInDown border-0 shadow-sm" role="alert">
            <i class="bi bi-cart-x display-1 text-muted d-block mb-3"></i>
            <h4 class="alert-heading">Tu carrito está vacío</h4>
            <p class="mb-3">¡Explora nuestros productos y encuentra lo que necesitas para tu vida universitaria!</p>
            <hr>
            <a th:href="@{/categoria}" class="btn btn-danger mt-2">
              <i class="bi bi-shop me-2"></i>Ver Productos
            </a>
          </div>
        </div>

        <div id="cart-items-list">
          <div th:each="item : ${carritoItems}" class="card mb-3 shadow-sm border-0">
            <div class="row g-0 align-items-center">
              <div class="col-md-3 text-center p-3">
                <img th:src="@{${item.producto.imagenUrlPrincipal}}" alt="Producto" class="img-fluid rounded"
                  style="max-height:120px;">
              </div>
              <div class="col-md-4">
                <div class="card-body">
                  <h6 class="card-title mb-1" th:text="${item.producto.nombre}">Nombre del Producto</h6>
                  <p class="text-muted mb-0" th:text="'S/ ' + ${item.producto.precio}">S/ 0.00</p>
                </div>
              </div>
              <div class="col-md-3 text-center">
                <form th:action="@{/carrito/actualizar-cantidad}" method="post" class="d-inline"
                  th:data-item-id="${item.id}">
                  <input type="hidden" name="itemId" th:value="${item.id}">
                  <div class="d-flex justify-content-center align-items-center">
                    <button type="submit" name="cantidad" th:value="${item.cantidad - 1}" class="btn btn-light border"
                      th:disabled="${item.cantidad <= 1}">-</button>
                    <input type="number" min="1" class="form-control text-center mx-2" style="width: 60px;"
                      th:value="${item.cantidad}" readonly>
                    <button type="submit" name="cantidad" th:value="${item.cantidad + 1}"
                      class="btn btn-light border">+</button>
                  </div>
                </form>
              </div>
              <div class="col-md-2 d-flex flex-column align-items-center justify-content-center px-2">
                <form th:action="@{/carrito/eliminar/{id}(id=${item.id})}" method="post" class="d-inline">
                  <button type="submit" class="btn btn-sm btn-danger mb-2 ms-2">
                    <i class="bi bi-trash"></i>
                  </button>
                </form>
                <p class="fw-bold mt-2 ms-2" th:text="'Subtotal: S/ ' + ${item.subtotal}">Subtotal: S/ 0.00</p>
              </div>
            </div>
          </div>
        </div>
      </div>

      <div class="col-lg-4">
        <div class="card p-3 shadow-sm mt-lg-5">
          <h6 class="fw-bold mb-3">Resumen del Pedido</h6>
          <div class="d-flex justify-content-between mb-2">
            <span>Subtotal</span>
            <span id="order-summary-subtotal" th:text="'S/ ' + ${subtotal}">S/ 0.00</span>
          </div>
          <div class="d-flex justify-content-between mb-2">
            <span>Envío</span>
            <span id="order-summary-shipping" th:text="${subtotal > 100} ? 'GRATIS' : 'S/ 10.00'">GRATIS</span>
          </div>
          <p class="text-success small mb-3">¡Envío gratis por compras mayores a S/100!</p>
          <hr>
          <div class="d-flex justify-content-between fw-bold my-3">
            <span>Total</span>
            <span id="order-summary-total" th:text="'S/ ' + ${total}">S/ 0.00</span>
          </div>

          <a class="btn btn-danger w-100" th:href="@{/carrito/checkout}">Proceder al Pago</a>
          <p class="text-muted small mt-2">
            <i class="bi bi-shield-lock"></i> Compra 100% segura
          </p>
        </div>
      </div>
    </div>
  </main>

  <div th:replace="~{layout/_layout :: footer}"></div>


  <script th:src="@{/js/api.js}"></script>
  <script th:src="@{/js/carrito.js}"></script>
</body>

</html>