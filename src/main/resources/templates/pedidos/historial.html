<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head th:replace="~{layout/_layout :: head('UTP Market | Mis Pedidos')}"></head>
<body>
    <header th:replace="~{layout/_layout :: header}"></header>

    <main style="margin-top: 80px; background-color: #f8f9fa; min-height: 100vh;">
        <div class="container py-4">
            <!-- Encabezado -->
            <div class="row mb-4">
                <div class="col">
                    <h2><i class="fas fa-shopping-bag"></i> Mis Pedidos</h2>
                    <p class="text-muted">Revisa el historial de tus compras</p>
                </div>
            </div>

            <!-- Lista de Pedidos -->
            <div class="row">
                <!-- Si NO hay pedidos -->
                <div th:if="${#lists.isEmpty(pedidos)}" class="col-12">
                    <div class="sin-pedidos">
                        <i class="fas fa-box-open fa-5x text-muted mb-3"></i>
                        <h4>No tienes pedidos aún</h4>
                        <p class="text-muted">Cuando realices tu primera compra, aparecerá aquí</p>
                        <a href="/productos" class="btn btn-primary mt-3">
                            <i class="fas fa-shopping-cart"></i> Ir a comprar
                        </a>
                    </div>
                </div>

                <!-- Si SÍ hay pedidos -->
                <div th:if="${!#lists.isEmpty(pedidos)}" class="col-12">
                    <!-- Iterar sobre cada pedido -->
                    <div th:each="pedido : ${pedidos}" class="card pedido-card mb-3"
                         th:onclick="'location.href=\'/pedidos/detalle/' + ${pedido.id} + '\''">
                        <div class="card-body">
                            <div class="row align-items-center">
                                <!-- Columna 1: Número de pedido -->
                                <div class="col-md-3">
                                    <h5 class="mb-1">
                                        <i class="fas fa-receipt text-primary"></i>
                                        <span th:text="${pedido.numero_pedido}">PED-001</span>
                                    </h5>
                                    <small class="text-muted">
                                        <i class="far fa-calendar"></i>
                                        <span th:text="${#dates.format(pedido.fecha_pedido, 'dd/MM/yyyy')}">15/01/2024</span>
                                    </small>
                                </div>

                                <!-- Columna 2: Estado -->
                                <div class="col-md-3 text-center">
                                                                        <span class="badge badge-estado"
                                                                              th:with="estadoNombre=${pedido.estado.nombre}"
                                                                              th:classappend="${estadoNombre == 'Entregado' ? 'bg-success' :
                                                                                               (estadoNombre == 'Cancelado' ? 'bg-danger' :
                                                                                               (estadoNombre == 'En proceso' ? 'bg-warning text-dark' :
                                                                                               'bg-info'))}"
                                                                              th:text="${estadoNombre}">
                                                                            En proceso
                                                                        </span>                                </div>

                                <!-- Columna 3: Productos -->
                                <div class="col-md-3">
                                    <small class="text-muted">
                                        <i class="fas fa-box"></i>
                                        <span th:text="${#lists.size(pedido.itemsPedido)}">3</span> producto(s)
                                    </small>
                                </div>

                                <!-- Columna 4: Total -->
                                <div class="col-md-3 text-end">
                                    <h4 class="mb-0 text-primary">
                                        S/ <span th:text="${#numbers.formatDecimal(pedido.total, 1, 2)}">150.00</span>
                                    </h4>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>


            <div class="row mt-4">
                <div class="col">
                    <a href="/" class="btn btn-secondary">
                        <i class="fas fa-arrow-left"></i> Volver al inicio
                    </a>
                </div>
            </div>
        </div>
    </main>

    <footer th:replace="~{layout/_layout :: footer}"></footer>
</body>
</html>