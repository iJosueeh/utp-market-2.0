<!DOCTYPE html>
	<html lang="es" xmlns:th="http://www.thymeleaf.org">
	
	<head th:replace="~{layout/_layout :: head('UTP Market | Perfil')}"></head>
	
	<body>
		<header th:replace="~{layout/_layout :: header}"></header>
	
		<main style="margin-top: 80px; background-color: #f8f9fa; min-height: 100vh;">
			<div class="container py-4">

				<div th:if="${success}" class="alert alert-success alert-dismissible fade show" role="alert">
					<span th:text="${success}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>
				<div th:if="${error}" class="alert alert-danger alert-dismissible fade show" role="alert">
					<span th:text="${error}"></span>
					<button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
				</div>

				<!-- Encabezado -->
				<div class="mb-4">
					<h2 class="fw-bold mb-1">Mi Cuenta</h2>
					<p class="text-muted">Gestiona tu perfil y preferencias de UTP Market</p>
				</div>
	
				<!-- Tabs de navegación -->
				<ul class="nav nav-tabs mb-4" id="profileTabs" role="tablist">
					<li class="nav-item" role="presentation">
						<button class="nav-link active" id="perfil-tab" data-bs-toggle="tab" data-bs-target="#perfil"
							type="button" role="tab">
							<i class="bi bi-person me-2"></i>Perfil
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="pedidos-tab" data-bs-toggle="tab" data-bs-target="#pedidos"
							type="button" role="tab">
							<i class="bi bi-bag me-2"></i>Pedidos
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="favoritos-tab" data-bs-toggle="tab" data-bs-target="#favoritos"
							type="button" role="tab">
							<i class="bi bi-heart me-2"></i>Favoritos
						</button>
					</li>
					<li class="nav-item" role="presentation">
						<button class="nav-link" id="resenas-tab" data-bs-toggle="tab" data-bs-target="#resenas"
							type="button" role="tab">
							<i class="bi bi-star me-2"></i>Reseñas
						</button>
					</li>
				</ul>
	
				<!-- Contenido de los tabs -->
				<div class="tab-content" id="profileTabsContent">
					<!-- Tab Perfil -->
					<div class="tab-pane fade show active" id="perfil" role="tabpanel">
						<div class="mb-4">
							<h4 class="fw-bold mb-1">Mi Perfil</h4>
							<p class="text-muted">Gestiona tu información personal</p>
						</div>
	
						<div class="row g-4">
							<!-- Tarjeta de Foto de Perfil -->
							<div class="col-lg-4">
								<div class="card shadow-sm">
									<div class="card-body text-center py-5">
											<div class="mb-4">
												<img th:if="${user.estudianteDetalles.photoUrl != null}" th:src="${user.estudianteDetalles.photoUrl}" alt="Foto de perfil" class="rounded-circle" style="width: 150px; height: 150px; object-fit: cover;">
												<div th:if="${user.estudianteDetalles.photoUrl == null}" class="rounded-circle bg-light d-inline-flex align-items-center justify-content-center" style="width: 150px; height: 150px;">
													<i class="bi bi-person-fill text-secondary" style="font-size: 4rem;"></i>
												</div>
											</div>
											<h5 class="mb-1" th:text="${user.nombre + ' ' + user.apellido}"></h5>
											<p class="text-muted mb-4">Estudiante UTP</p>
											<!-- Botón de cambiar foto deshabilitado temporalmente -->
									</div>
								</div>
							</div>
	
							<!-- Información Personal -->
							<div class="col-lg-8">
								<div class="card shadow-sm">
									<div class="card-header bg-white d-flex justify-content-between align-items-center">
										<h6 class="mb-0 fw-bold">Información Personal</h6>
										<button class="btn btn-link text-decoration-none p-0" data-bs-toggle="modal"
											data-bs-target="#editarPerfilModal">
											<i class="bi bi-pencil me-1"></i>Editar
										</button>
									</div>
									<div class="card-body">
										<div class="row g-4">
											<div class="col-md-6">
												<label class="text-muted small mb-1">Nombres</label>
												<p class="fw-semibold" th:text="${user.nombre}"></p>
											</div>
											<div class="col-md-6">
												<label class="text-muted small mb-1">Apellidos</label>
												<p class="fw-semibold" th:text="${user.apellido}"></p>
											</div>
											<div class="col-md-6">
												<label class="text-muted small mb-1">Correo Electrónico</label>
												<p class="fw-semibold">
													<i class="bi bi-envelope me-2 text-muted"></i>
													<span th:text="${user.email}"></span>
												</p>
											</div>
											<div class="col-md-6">
												<label class="text-muted small mb-1">Teléfono</label>
												<p class="fw-semibold">
													<i class="bi bi-phone me-2 text-muted"></i>
													<span th:text="${user.estudianteDetalles.telefono}"></span>
												</p>
											</div>
										</div>
									</div>
								</div>
	
								<!-- Información UTP -->
								<div class="card shadow-sm mt-4">
									<div class="card-header bg-white d-flex justify-content-between align-items-center">
										<div class="d-flex align-items-center">
											<div class="bg-danger rounded p-2 me-3">
												<i class="bi bi-mortarboard text-white"></i>
											</div>
											<div>
												<h6 class="mb-0 fw-bold">Información UTP</h6>
												<small class="text-muted">Datos de tu cuenta universitaria</small>
											</div>
										</div>
										<button class="btn btn-link text-decoration-none p-0" data-bs-toggle="modal" data-bs-target="#editarInformacionUtpModal">
											<i class="bi bi-pencil me-1"></i>Editar
										</button>
									</div>
									<div class="card-body">
										<div class="row g-4">
											<div class="col-md-4">
												<label class="text-muted small mb-1">Código de Estudiante</label>
												<p class="fw-semibold" th:text="${user.estudianteDetalles.codigo_estudiante}"></p>
											</div>
											<div class="col-md-4">
												<label class="text-muted small mb-1">Carrera</label>
												<p class="fw-semibold" th:text="${user.estudianteDetalles.carrera}"></p>
											</div>
											<div class="col-md-4">
												<label class="text-muted small mb-1">Ciclo</label>
												<p class="fw-semibold" th:text="${user.estudianteDetalles.ciclo}"></p>
											</div>
										</div>
									</div>
								</div>
	
								<!-- Seguridad -->
								<div class="card shadow-sm mt-4">
									<div class="card-header bg-white">
										<h6 class="mb-0 fw-bold">Seguridad</h6>
									</div>
									<div class="card-body">
										<div
											class="d-flex justify-content-between align-items-center mb-3 pb-3 border-bottom">
											<div>
												<p class="mb-1 fw-semibold">Contraseña</p>
												<small class="text-muted">Última actualización: 1 Oct 2024</small>
											</div>
											<button class="btn btn-outline-primary btn-sm" data-bs-toggle="modal"
												data-bs-target="#cambiarPasswordModal">
												Cambiar contraseña
											</button>
										</div>
										<div class="d-flex justify-content-between align-items-center">
											<div>
												<p class="mb-1 fw-semibold">Autenticación en dos pasos</p>
												<small class="text-muted">Agrega una capa extra de seguridad</small>
											</div>
											<button class="btn btn-outline-secondary btn-sm">
												Configurar
											</button>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
	
					<!-- Tab Pedidos -->
					<div class="tab-pane fade" id="pedidos" role="tabpanel">
						<div class="text-center py-5">
							<i class="bi bi-bag text-muted" style="font-size: 4rem;"></i>
							<h5 class="mt-3">No tienes pedidos aún</h5>
							<p class="text-muted">Tus pedidos aparecerán aquí</p>
						</div>
					</div>

					<!-- Tab Favoritos -->
					<div class="tab-pane fade" id="favoritos" role="tabpanel">
						<div class="text-center py-5">
							<i class="bi bi-heart text-muted" style="font-size: 4rem;"></i>
							<h5 class="mt-3">No tienes favoritos</h5>
							<p class="text-muted">Guarda tus productos favoritos aquí</p>
						</div>
					</div>
	
					<!-- Tab Reseñas -->
					<div class="tab-pane fade" id="resenas" role="tabpanel">
						<div class="text-center py-5">
							<i class="bi bi-star text-muted" style="font-size: 4rem;"></i>
							<h5 class="mt-3">No has dejado reseñas</h5>
							<p class="text-muted">Tus reseñas aparecerán aquí</p>
						</div>
					</div>
				</div>
			</div>
	
			<!-- Modal Editar Perfil -->
			<div class="modal fade" id="editarPerfilModal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Editar Información Personal</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<form th:action="@{/usuario/actualizar}" method="post">
							<div class="modal-body">
								<div class="mb-3">
									<label class="form-label">Nombres</label>
									<input type="text" class="form-control" name="nombre" th:value="${user.nombre}">
								</div>
								<div class="mb-3">
									<label class="form-label">Apellidos</label>
									<input type="text" class="form-control" name="apellido" th:value="${user.apellido}">
								</div>
								<div class="mb-3">
									<label class="form-label">Teléfono</label>
									<input type="tel" class="form-control" name="estudianteDetalles.telefono" th:value="${user.estudianteDetalles.telefono}">
								</div>
								<div class="mb-3">
									<label class="form-label">Fecha de Nacimiento</label>
									<input type="date" class="form-control" name="estudianteDetalles.fecha_nacimiento"
										th:value="${#dates.format(user.estudianteDetalles.fecha_nacimiento, 'yyyy-MM-dd')}">
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
								<button type="submit" class="btn btn-primary">Guardar cambios</button>
							</div>
						</form>
					</div>
				</div>
			</div>
	
			<!-- Modal Editar Informacion UTP -->
			<div class="modal fade" id="editarInformacionUtpModal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Editar Información UTP</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<form th:action="@{/usuario/actualizar-utp}" method="post">
							<div class="modal-body">
								<div class="mb-3">
									<label class="form-label">Código de Estudiante</label>
									<input type="text" class="form-control" name="estudianteDetalles.codigo_estudiante" th:value="${user.estudianteDetalles.codigo_estudiante}" readonly>
								</div>
								<div class="mb-3">
									<label class="form-label">Carrera</label>
									<select class="form-select" name="estudianteDetalles.carrera">
										<option value="">Seleccione una carrera</option>
										<option th:each="carrera : ${carrerasUtp}"
											th:value="${carrera}"
											th:selected="${carrera == user.estudianteDetalles.carrera}"
											th:text="${carrera}"></option>
									</select>
								</div>
								<div class="mb-3">
									<label class="form-label">Ciclo</label>
									<select class="form-select" name="estudianteDetalles.ciclo">
										<option value="">Seleccione un ciclo</option>
										<option th:each="i : ${#numbers.sequence(1, 10)}"
											th:value="${i}"
											th:selected="${i == user.estudianteDetalles.ciclo}"
											th:text="${i}"></option>
									</select>
								</div>
							</div>
							<div class="modal-footer">
								<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
								<button type="submit" class="btn btn-primary">Guardar cambios</button>
							</div>
						</form>
					</div>
				</div>
			</div>
	
			<!-- Modal Cambiar Contraseña -->
			<div class="modal fade" id="cambiarPasswordModal" tabindex="-1">
				<div class="modal-dialog">
					<div class="modal-content">
						<div class="modal-header">
							<h5 class="modal-title">Cambiar Contraseña</h5>
							<button type="button" class="btn-close" data-bs-dismiss="modal"></button>
						</div>
						<form th:action="@{/usuario/cambiar-password}" method="post">
							<div class="modal-body">
								<div class="mb-3">
									<label class="form-label">Contraseña actual</label>
									<input type="password" class="form-control" name="passwordActual" required>
							</div>
							<div class="mb-3">
								<label class="form-label">Nueva contraseña</label>
								<input type="password" class="form-control" name="passwordNueva" required>
							</div>
							<div class="mb-3">
								<label class="form-label">Confirmar nueva contraseña</label>
								<input type="password" class="form-control" name="passwordConfirmar" required>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
								<button type="submit" class="btn btn-primary">Cambiar contraseña</button>
							</div>
						</form>
					</div>
				</div>
			</div>
		</div>
	</main>
	
	<style>
		.nav-tabs .nav-link {
			color: #6c757d;
			border: none;
			border-bottom: 3px solid transparent;
			padding: 0.75rem 1rem;
		}
	
		.nav-tabs .nav-link:hover {
			border-color: transparent;
			background-color: rgba(0, 0, 0, 0.05);
		}
	
		.nav-tabs .nav-link.active {
			color: #B50D30;
			border-color: #B50D30;
			background-color: transparent;
		}
	
		.card {
			border: none;
			border-radius: 0.5rem;
		}
	
		.btn-link {
			color: #B50D30;
		}
	
		.btn-link:hover {
			color: #8a0a24;
		}
	
		.btn-primary {
			background-color: #B50D30;
			border-color: #B50D30;
		}
	
		.btn-primary:hover {
			background-color: #8a0a24;
			border-color: #8a0a24;
		}
	
		.btn-outline-primary {
			color: #B50D30;
			border-color: #B50D30;
		}
	
		.btn-outline-primary:hover {
			background-color: #B50D30;
			border-color: #B50D30;
		}
	</style>
	
	<footer th:replace="~{layout/_layout :: footer}"></footer>
	</body>
	</html>